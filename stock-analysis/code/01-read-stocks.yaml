kind: remote
metadata:
  name: stocks-reader
  tag: ''
  hash: b82602cc902daa4eff1d628b5176df0758f7b60f
  project: stocks-dani
spec:
  command: ''
  args: []
  image: ''
  description: ''
  min_replicas: 1
  max_replicas: 4
  env: []
  base_spec:
    apiVersion: nuclio.io/v1
    kind: Function
    metadata:
      annotations:
        nuclio.io/generated_by: function generated from /User/test/demos/stock-analysis/code/01-read-stocks.ipynb
      labels: {}
      name: stocks-reader
    spec:
      build:
        baseImage: mlrun/mlrun:0.6.5-rc15
        commands:
        - pip install lxml
        - pip install yfinance
        - pip install requests
        - pip install v3io_frames
        functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IHlmaW5hbmNlIGFzIHlmCmltcG9ydCBvcwppbXBvcnQgcGFuZGFzIGFzIHBkCmltcG9ydCB2M2lvX2ZyYW1lcyBhcyB2M2YKaW1wb3J0IGFzdAppbXBvcnQgbWxydW4uZmVhdHVyZV9zdG9yZSBhcyBmcwppbXBvcnQgbWxydW4KaW1wb3J0IGRhdGV0aW1lCmZyb20gbWxydW4uZGF0YXN0b3JlLnRhcmdldHMgaW1wb3J0IFBhcnF1ZXRUYXJnZXQKCmRlZiB1cGRhdGVfdGlja2Vycyhjb250ZXh0LCBzdGFydCwgZW5kLCBpbnRlcnZhbCk6CiAgICBhbGxfcmVjb3Jkcz1bXQogICAgc3RvY2tzX2RmID0gcGQuRGF0YUZyYW1lKCkKICAgIGZvciBzeW0gaW4gY29udGV4dC5zdG9ja19zeW1zOgogICAgICAgIGhpc3QgPSB5Zi5UaWNrZXIoc3ltKS5oaXN0b3J5KHN0YXJ0PXN0YXJ0LCBlbmQ9ZW5kLGludGVydmFsPWludGVydmFsKS5kcm9wKFsiRGl2aWRlbmRzIiwiU3RvY2sgU3BsaXRzIl0sYXhpcz0xKQogICAgICAgIHRpbWUgPSBoaXN0LmluZGV4W2xlbihoaXN0KSAtIDFdCiAgICAgICAgcmVjb3JkID0gaGlzdC5sb2NbdGltZV0KICAgICAgICBsYXN0ID0gY29udGV4dC5sYXN0X3RyYWRlX3RpbWVzLmdldChzeW0pCiAgICAgICAgaWYgbGFzdDoKICAgICAgICAgICAgaGlzdCA9IGhpc3RbaGlzdC5pbmRleD5sYXN0XQogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZidSZWNlaXZlZCB7c3ltfSBkYXRhIGZyb20geWZpbmFuY2UsIGluY2x1ZGluZyB7bGVuKGhpc3QpfSBjYW5kbGVzIGVuZGluZyBhdCB7bGFzdH0nKQogICAgICAgIGlmIG5vdCBsYXN0IG9yIHRpbWUgPiBsYXN0OgogICAgICAgICAgICBmc19kYXRhID0gaGlzdC5jb3B5KCkucmVzZXRfaW5kZXgoKQogICAgICAgICAgICBmc19kYXRhWyJzeW1ib2wiXT1zeW0KICAgICAgICAgICAgZnNfZGF0YS5zZXRfaW5kZXgoInN5bWJvbCIsaW5wbGFjZT1UcnVlKQogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYiV3JpdGluZyBuZXcgZGF0YWZyYW1lIHdpdGggc2hhcGUge2ZzX2RhdGEuc2hhcGV9IHRvIGZlYXR1cmUgc3RvcmUiKQogICAgICAgICAgICBmc19kYXRhWyJEYXRldGltZSJdID0gZnNfZGF0YVsiRGF0ZXRpbWUiXS5kdC50el9jb252ZXJ0KCdVVEMnKQogICAgICAgICAgICBmcy5pbmdlc3QoY29udGV4dC5zdG9ja19pbmZvX2ZlYXR1cmVfc2V0LCBmc19kYXRhLCBpbmZlcl9vcHRpb25zPWZzLkluZmVyT3B0aW9ucy5kZWZhdWx0KCksCiAgICAgICAgICAgICAgICAgICAgIG92ZXJ3cml0ZT1GYWxzZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHN0b2NrID0geydzeW1ib2wnOiBzeW0sICdwcmljZSc6IHJlY29yZFsnQ2xvc2UnXSwgJ3ZvbHVtZSc6IHJlY29yZFsnVm9sdW1lJ10sICdsYXN0X3VwZGF0ZWQnOiB0aW1lfQogICAgICAgICAgICBleHByID0gY29udGV4dC5leHByX3RlbXBsYXRlLmZvcm1hdCgqKnN0b2NrKQogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5kZWJ1Z193aXRoKCd1cGRhdGUgZXhwcmVzc2lvbicsIHN5bWJvbD1zeW0sIGV4cHI9ZXhwcikKICAgICAgICAgICAgY29udGV4dC52M2MuZXhlY3V0ZSgna3YnLCBjb250ZXh0LnN0b2Nrc19rdl90YWJsZSwgJ3VwZGF0ZScsIGFyZ3M9eydrZXknOiBzeW0sICdleHByZXNzaW9uJzogZXhwcn0pCiAgICAgICAgIAogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYnVXBkYXRlZCByZWNvcmRzIGZyb20ge2xhc3R9IHRvIHt0aW1lfScpCiAgICAgICAgICAgIGNvbnRleHQubGFzdF90cmFkZV90aW1lc1tzeW1dID0gdGltZQogICAgICAgICAgICBoaXN0WydzeW1ib2wnXSA9IHN5bQogICAgICAgICAgICBoaXN0ID0gaGlzdC5yZXNldF9pbmRleCgpCiAgICAgICAgICAgIGhpc3QgPSBoaXN0LnNldF9pbmRleChbJ0RhdGV0aW1lJywgJ3N5bWJvbCddKQogICAgICAgICAgICBoaXN0ID0gaGlzdC5sb2NbOiwgWydDbG9zZScsICdWb2x1bWUnXV0KICAgICAgICAgICAgaGlzdCA9IGhpc3QucmVuYW1lKGNvbHVtbnM9eydDbG9zZSc6ICdwcmljZScsICdWb2x1bWUnOiAndm9sdW1lJ30pCiAgICAgICAgICAgIHN0b2Nrc19kZiA9IHN0b2Nrc19kZi5hcHBlbmQoaGlzdCkKICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbyhmJ0FkZGVkIHJlY29yZHMge2hpc3Quc2hhcGVbMF19IHJlY29yZHMgZm9yIHtzeW19IHRvIGhpc3RvcnknKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZidObyB1cGRhdGUgd2FzIG1hZGUsIGN1cnJlbnQgVFM6IHtsYXN0fSB2cy4gbmV3IGRhdGEge3RpbWV9JykKICAgIAogICAgY29udGV4dC52M2MuZXhlY3V0ZSgia3YiLHRhYmxlID0gY29udGV4dC5zdG9ja3Nfa3ZfdGFibGUsIGNvbW1hbmQgPSAiaW5mZXIiKQogICAgCiAgICBpZiBzdG9ja3NfZGYuc2hhcGVbMF0+MDoKICAgICAgICBzdG9ja3NfZGYgPSBzdG9ja3NfZGYuc29ydF9pbmRleChsZXZlbD0wKQogICAgICAgIGNvbnRleHQubG9nZ2VyLmRlYnVnX3dpdGgoJ3dyaXRpbmcgZGF0YSB0byBUU0RCJywgc3RvY2tzPXN0b2Nrc19kZikKICAgICAgICBzdG9ja3NfZGYudG9fY3N2KCdoaXN0b3J5LmNzdicpCiAgICAgICAgY29udGV4dC52M2Mud3JpdGUoYmFja2VuZD0ndHNkYicsIHRhYmxlPWNvbnRleHQuc3RvY2tzX3RzZGJfdGFibGUsIGRmcz1zdG9ja3NfZGYpCgpkZWYgaW5pdF9jb250ZXh0KGNvbnRleHQpOgogICAgY29udGV4dC5sb2dnZXIuaW5mbygiaW5pdCBzdG9ja3MgcmVhZGVyIGNvbnRleHQiKQogICAgc2V0YXR0cihjb250ZXh0LCAnUFJPSkVDVF9OQU1FJywgb3MuZ2V0ZW52KCdQUk9KRUNUX05BTUUnLCAnc3RvY2tzLScgKyBvcy5nZXRlbnYoJ1YzSU9fVVNFUk5BTUUnKSkpCiAgICBtbHJ1bi5zZXRfZW52aXJvbm1lbnQocHJvamVjdCA9IGNvbnRleHQuUFJPSkVDVF9OQU1FKQogICAgc2V0YXR0cihjb250ZXh0LCJWM0lPX0ZSQU1FU0QiLCBvcy5nZXRlbnYoIlYzSU9fRlJBTUVTRCIsJ2ZyYW1lc2Q6ODA4MScpKQogICAgY2xpZW50ID0gdjNmLkNsaWVudChjb250ZXh0LlYzSU9fRlJBTUVTRCwgY29udGFpbmVyPW9zLmdldGVudignVjNJT19DT05UQUlORVInLCAndXNlcnMnKSkKICAgIHNldGF0dHIoY29udGV4dCwgJ3YzYycsIGNsaWVudCkKICAgIAogICAgc2V0YXR0cihjb250ZXh0LCAnc3RvY2tzX2t2X3RhYmxlJywgb3MuZ2V0ZW52KCdTVE9DS1NfS1ZfVEFCTEUnLCBvcy5nZXRlbnYoJ1YzSU9fVVNFUk5BTUUnKSArICcvc3RvY2tzL3N0b2Nrc19rdicpKQogICAgc2V0YXR0cihjb250ZXh0LCAnc3RvY2tzX3RzZGJfdGFibGUnLCBvcy5nZXRlbnYoJ1NUT0NLU19UU0RCX1RBQkxFJywgb3MuZ2V0ZW52KCdWM0lPX1VTRVJOQU1FJykgKyAnL3N0b2Nrcy9zdG9ja3NfdHNkYicpKQogICAgY29udGV4dC52M2MuY3JlYXRlKGJhY2tlbmQ9J3RzZGInLCB0YWJsZT1jb250ZXh0LnN0b2Nrc190c2RiX3RhYmxlLCByYXRlPScxL20nLCBpZl9leGlzdHM9MSkKICAgIAogICAgc3RvY2tzX2luZm9fc2V0ID0gZnMuRmVhdHVyZVNldCgic3RvY2tzIiwgZW50aXRpZXM9W2ZzLkVudGl0eSgic3ltYm9sIildLHRpbWVzdGFtcF9rZXk9IkRhdGV0aW1lIikKICAgIHN0b2Nrc19pbmZvX3NldC5zZXRfdGFyZ2V0cyh0YXJnZXRzPVtQYXJxdWV0VGFyZ2V0KG5hbWU9InN0b2NrcyIscGFydGl0aW9uZWQ9VHJ1ZSx0aW1lX3BhcnRpdGlvbmluZ19ncmFudWxhcml0eT0iZGF5IildCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLHdpdGhfZGVmYXVsdHM9RmFsc2UpCiAgICBzZXRhdHRyKGNvbnRleHQsJ3N0b2NrX2luZm9fZmVhdHVyZV9zZXQnLHN0b2Nrc19pbmZvX3NldCkKICAgIAogICAgY29udGV4dC5zdG9ja19pbmZvX2ZlYXR1cmVfc2V0LmFkZF9hZ2dyZWdhdGlvbigiT3BlbnMiLCJPcGVuIixbIm1pbiIsIm1heCJdLFsiMWgiXSkKICAgIGNvbnRleHQuc3RvY2tfaW5mb19mZWF0dXJlX3NldC5hZGRfYWdncmVnYXRpb24oIlZvbHVtZXMiLCJWb2x1bWUiLFsibWluIiwibWF4Il0sWyIxaCJdKQogICAgCiAgICBzdG9ja3MgPSBvcy5nZXRlbnYoJ1NUT0NLX0xJU1QnLCdHT09HTCxNU0ZULEFNWk4sQUFQTCxJTlRDJykKICAgIGlmIHN0b2Nrcy5zdGFydHN3aXRoKCdbJyk6CiAgICAgICAgc3RvY2tfc3ltcyA9IGFzdC5saXRlcmFsX2V2YWwoc3RvY2tzKQogICAgZWxzZTogCiAgICAgICAgc3RvY2tfc3ltcyA9IHN0b2Nrcy5zcGxpdCgnLCcpCiAgICBzZXRhdHRyKGNvbnRleHQsICdzdG9ja19zeW1zJywgc3RvY2tfc3ltcykKICAgIAoKICAgIGV4cHJfdGVtcGxhdGUgPSBvcy5nZXRlbnYoJ0VYUFJFU1NJT05fVEVNUExBVEUnLCAic3ltYm9sPSd7c3ltYm9sfSc7cHJpY2U9e3ByaWNlfTt2b2x1bWU9e3ZvbHVtZX07bGFzdF91cGRhdGVkPSd7bGFzdF91cGRhdGVkfSciKQogICAgc2V0YXR0cihjb250ZXh0LCAnZXhwcl90ZW1wbGF0ZScsIGV4cHJfdGVtcGxhdGUpCgogICAgbGFzdF90cmFkZV90aW1lcyA9IHt9CiAgICBzZXRhdHRyKGNvbnRleHQsICdsYXN0X3RyYWRlX3RpbWVzJywgbGFzdF90cmFkZV90aW1lcykKICAgIAogICAgc3RhcnQgPSBkYXRldGltZS5kYXRldGltZS5ub3coKS1kYXRldGltZS50aW1lZGVsdGEoNSkKICAgIGVuZCA9IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpLWRhdGV0aW1lLnRpbWVkZWx0YSgyKQogICAgc19kZiA9IHVwZGF0ZV90aWNrZXJzKGNvbnRleHQsIHN0YXJ0PXN0YXJ0LCBlbmQ9ZW5kLGludGVydmFsPSIxbSIpCgpkZWYgaGFuZGxlcihjb250ZXh0LGV2ZW50KToKICAgIHN0YXJ0ID0gZGF0ZXRpbWUuZGF0ZXRpbWUubm93KCktZGF0ZXRpbWUudGltZWRlbHRhKDMpCiAgICBlbmQgPSBkYXRldGltZS5kYXRldGltZS5ub3coKQogICAgc3RvY2tzX2RmID0gdXBkYXRlX3RpY2tlcnMoY29udGV4dCwgc3RhcnQ9c3RhcnQsIGVuZD1lbmQsaW50ZXJ2YWw9IjFtIikKCg==
        noBaseImagesPull: true
      env:
      - name: V3IO_ACCESS_KEY
        value: a053dc07-03d1-42da-824e-9b740ac307f4
      - name: V3IO_USERNAME
        value: dani
      - name: V3IO_API
        value: v3io-webapi.default-tenant.svc:8081
      handler: 01-read-stocks:handler
      runtime: python:3.6
      volumes: []
  source: ''
  build:
    commands: []
    code_origin: https://github.com/daniels290813/demos.git#f1d8e6d59a84cf237c1819343019bd028c589796:stocks-reader.ipynb
  default_handler: handler
  affinity: null
verbose: false
